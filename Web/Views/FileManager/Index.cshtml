@{
	ViewBag.Title = "Media Management";
	ViewBag.AngularApp = "FileManagerApp";
	ViewBag.BodyClass = "ng-cloak" + (ViewBag.view == "fullpage" ? " fullpage" : string.Empty);
	Layout = "~/Views/FileManager/_FileManagerLayout.cshtml";
	var editor = ViewBag.Editor != "" ? new { editor = ViewBag.Editor, type = ViewBag.type } : null;
}

@if (ViewBag.view == "fullpage")
{
	<div class="alert alert-info alert-control">
		<a class="alert-link" href="javascript:void(0)" onclick="history.back();"><i class="glyphicon glyphicon-menu-left" aria-hidden="true"></i> Back to Website</a>
	</div>
}

@if (ViewBag.type == "file" || ViewBag.type == "folder")
{
	<div class="alert alert-info alert-control">
		<i class="glyphicon glyphicon-file"></i>
		@Html.ActionLink("Pick a Page", "Pages", editor, new { @class = "alert-link" })
	</div>
}

<angular-filemanager></angular-filemanager>

@section Styles {
	<link rel="stylesheet" href="~/Content/FileManager/dist/angular-filemanager.min.css">
}

@section Scripts {
	<script src="~/Content/FileManager/bower_components/angular/angular.min.js"></script>
	<script src="~/Content/FileManager/bower_components/angular-translate/angular-translate.min.js"></script>
	<script src="~/Content/FileManager/bower_components/ng-file-upload/ng-file-upload.min.js"></script>
	<script src="~/Content/FileManager/dist/angular-filemanager.min.js"></script>
	<script>
		var picker = getQueryString('editor');

		angular.module('FileManagerApp').config(['fileManagerConfigProvider', function (config) {
			var defaults = config.$get();
			config.set({
				appName: '@ViewBag.RootName',
				pickCallback: function (item) {
					var url = '@ViewBag.virtualPath' + item.fullPath();

					if (picker != null) {
						switch (picker) {
							case 'ckeditor':
								ckSubmit(url);
								break;

							case 'tinymce':
								tmceSubmit(url);
								break;

							case 'filepicker':
								fpSubmit(url);
								break;
						}
					};
				},
				allowedActions: angular.extend(defaults.allowedActions, {
					pickFiles: picker != null ? true : false,
					pickFolders: false,
					changePermissions: false
				}),
				listUrl: '/fileservice',
				uploadUrl: '/fileservice/fileupload',
				renameUrl: '/fileservice',
				copyUrl: '/fileservice',
				moveUrl: '/fileservice',
				removeUrl: '/fileservice',
				editUrl: '/fileservice',
				getContentUrl: '/fileservice',
				createFolderUrl: '/fileservice',
				downloadFileUrl: '/fileservice',
				downloadMultipleUrl: '/fileservice',
				compressUrl: '/fileservice',
				extractUrl: '/fileservice',
				permissionsUrl: '/fileservice',
				basePath: '/',
				fileSystemToken: '@ViewBag.fileSystemToken',
				typeQueryString: '@ViewBag.type',
				hidePermissions: true,
				multipleDownloadFileName: 'angular-filemanager.zip'
			});
		}]);
	</script>
}